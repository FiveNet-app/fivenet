syntax = "proto3";

package services.centrum;
option go_package = "github.com/galexrt/fivenet/gen/go/proto/services/centrum;centrum";

import "resources/dispatch/units.proto";
import "validate/validate.proto";

// Unit Management

message ListUnitsRequest {
  repeated resources.dispatch.UNIT_STATUS status = 1;
  optional string name = 2;
}

message ListUnitsResponse {
  repeated resources.dispatch.Unit units = 1;
}

message CreateOrUpdateUnitRequest {
  resources.dispatch.Unit unit = 1 [(validate.rules).message.required = true];
}

message CreateOrUpdateUnitResponse {
  resources.dispatch.Unit unit = 1;
}

message DeleteUnitRequest {
  uint64 unit_id = 1;
}

message DeleteUnitResponse {}

message AssignUnitRequest {
  uint64 unit_id = 1;
  repeated int32 to_add = 2;
  repeated int32 to_remove = 3;
}

message AssignUnitResponse {
  uint64 unit_id = 1;
  optional bool self = 2;
  repeated uint64 user_ids = 3;
}

message UpdateUnitStatusRequest {
  uint64 unit_id = 1;
  resources.dispatch.UNIT_STATUS status = 2;
  optional string reason = 3;
}

message UpdateUnitStatusResponse {}

message UnitChanges {
  repeated UnitChange changes = 1;
}

message UnitChange {
  uint64 id = 1;
  repeated int32 added = 2;
  repeated int32 removed = 3;
}

// Dispatch Management

message CreateDispatchRequest {

}

message CreateDispatchResponse {

}

message UpdateDispatchRequest {

}

message UpdateDispatchResponse {

}

message TakeDispatchRequest {

}

message TakeDispatchResponse {

}

message DispatchChanges {
  repeated DispatchChange changes = 1;
}

message DispatchChange {
  uint64 id = 1;
}

message CentrumStreamRequest {}

message CentrumStreamResponse {
  optional UnitChanges unit_changes = 1;
  optional DispatchChanges dispatch_changes = 2;
}

service CentrumService {
  // @perm
  rpc ListUnits(ListUnitsRequest) returns (ListUnitsResponse);
  // @perm
  rpc CreateOrUpdateUnit(CreateOrUpdateUnitRequest) returns (CreateOrUpdateUnitResponse);
  // @perm
  rpc DeleteUnit(DeleteUnitRequest) returns (DeleteUnitResponse);

  // @perm: Attrs=Access/StringList:[]string{"Own", "Lower_Rank", "Same_Rank"}ยง[]string{"Own"}
  rpc AssignUnit(AssignUnitRequest) returns (AssignUnitResponse);

  // @perm
  rpc UpdateUnitStatus(UpdateUnitStatusRequest) returns (UpdateUnitStatusResponse);

  // @perm
  rpc CreateDispatch(CreateDispatchRequest) returns (CreateDispatchResponse);
  // @perm
  rpc UpdateDispatch(UpdateDispatchRequest) returns (UpdateDispatchResponse);

  // @perm
  rpc TakeDispatch(TakeDispatchRequest) returns (TakeDispatchResponse);

  // @perm
  rpc Stream(CentrumStreamRequest) returns (stream CentrumStreamResponse);
}
